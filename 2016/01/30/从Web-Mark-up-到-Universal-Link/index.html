<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>从Web Mark up 到 Universal Link | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="看似这是iOS9给开发者一个比较有用的隐藏功能">
<meta property="og:type" content="article">
<meta property="og:title" content="从Web Mark up 到 Universal Link">
<meta property="og:url" content="http://yoursite.com/2016/01/30/从Web-Mark-up-到-Universal-Link/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="看似这是iOS9给开发者一个比较有用的隐藏功能">
<meta property="og:image" content="http://7te818.com1.z0.glb.clouddn.com/14568532311607.jpg?imageView/2/w/600/q/60">
<meta property="og:image" content="http://7te818.com1.z0.glb.clouddn.com/picture915-2.png?imageView/2/w/400/q/45">
<meta property="og:image" content="http://7te818.com1.z0.glb.clouddn.com/14569005737114.jpg?imageView/2/w/600/q/60">
<meta property="og:image" content="http://7te818.com1.z0.glb.clouddn.com/14569089086483.jpg?imageView/2/w/600/q/60">
<meta property="og:image" content="http://7te818.com1.z0.glb.clouddn.com/14568124648916.jpg">
<meta property="og:updated_time" content="2016-05-01T09:30:44.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="从Web Mark up 到 Universal Link">
<meta name="twitter:description" content="看似这是iOS9给开发者一个比较有用的隐藏功能">
<meta name="twitter:image" content="http://7te818.com1.z0.glb.clouddn.com/14568532311607.jpg?imageView/2/w/600/q/60">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-从Web-Mark-up-到-Universal-Link" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/01/30/从Web-Mark-up-到-Universal-Link/" class="article-date">
  <time datetime="2016-01-29T19:17:52.000Z" itemprop="datePublished">2016-01-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      从Web Mark up 到 Universal Link
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>看似这是iOS9给开发者一个比较有用的隐藏功能<br><a id="more"></a></p>
<hr>
<p>###1.引子<br>&emsp;&emsp;时间拉回之前的Web Markup适配，由于国内的种种原因，导致没有办法使用上Web Markup功能，然后其背后的始作俑者Universal Link却暗藏玄机，让我细细道来。</p>
<p><strong>以下Universal Link均采用UL的简称，此处以供辨识。</strong></p>
<p>###2.UL能带来什么好处？<br>&emsp;&emsp;按照往常的App间跳转规则，一个App跳转到另外一个App中首先可以通过OpenURL的形式去打开，这个需要App间的洽谈，另外一种就是H5页面的主动唤起Alert后，去打开其他App。第一种需要双方都同意，第二种对用户也不够友好，阻碍了用户对原本浏览信息的过程。UL的作用是什么呢？用户几乎是无任何感知，就可以从一个App跳转到另外一个App，从代码实现层面上来说，也只需要需要跳转的App做一定的适配工作，这真是iOS9给我们带来的一个隐藏功能~</p>
<p>调研了以下App均可以通过UL形式进行跳转，毫无阻碍。</p>
<table>
<thead>
<tr>
<th>App Name</th>
<th>支持 UL </th>
</tr>
</thead>
<tbody>
<tr>
<td> 微博</td>
<td>✔︎</td>
<td></td>
</tr>
<tr>
<td> 微信</td>
<td>✔︎</td>
<td></td>
</tr>
<tr>
<td> 手机百度</td>
<td>✔︎</td>
<td></td>
</tr>
<tr>
<td>  手机淘宝</td>
<td>✔︎</td>
<td></td>
</tr>
<tr>
<td> UC浏览器</td>
<td>✔︎</td>
<td></td>
</tr>
<tr>
<td> 支付宝</td>
<td>✔︎</td>
<td></td>
</tr>
<tr>
<td> 大众点评</td>
<td>✔︎</td>
<td></td>
</tr>
<tr>
<td> Safari</td>
<td>✔︎</td>
<td></td>
</tr>
<tr>
<td> QQ iPad</td>
<td>✔︎</td>
<td></td>
</tr>
<tr>
<td> QQ</td>
<td>✗</td>
<td></td>
</tr>
<tr>
<td> QQ浏览器</td>
<td>✗</td>
<td></td>
</tr>
<tr>
<td> 什么值得买</td>
<td>✔︎</td>
<td></td>
</tr>
</tbody>
</table>
<p> UL支持最低iOS9.0系统</p>
<p> <strong>iOS多机型验证：</strong></p>
<table>
<thead>
<tr>
<th>系统版本</th>
<th>验证结果</th>
</tr>
</thead>
<tbody>
<tr>
<td>  9.3.1</td>
<td>fix UL文件过大导致UL失效的问题，支持通配符域名，例如*.haha.com</td>
</tr>
<tr>
<td>  9.3</td>
<td>Booking.com 将UL相关配置文件过大2MB左右，触发UL的一个BUG，导致无法唤起</td>
</tr>
<tr>
<td>  9.2.1</td>
<td>✔︎</td>
</tr>
<tr>
<td>  9.2</td>
<td>✔︎</td>
</tr>
<tr>
<td>  9.1</td>
<td>开始不支持跨域跳转</td>
</tr>
<tr>
<td>  9.0</td>
<td>支持不跨域跳转</td>
</tr>
</tbody>
</table>
<p>  iOS 9.3 BUG相关<a href="https://bencollier.net/2016/03/unable-to-open-links-in-safari-mail-or-messages-on-ios-9-3/?utm_campaign=iOS%2BDev%2BWeekly&amp;utm_medium=email&amp;utm_source=iOS_Dev_Weekly_Issue_244" target="_blank" rel="external">链接</a>。</p>
<p>  iOS 9.3及以上支持通配符 <a href="http://fortheloveoftech.com/2016/01/25/apple-releases-ios-9-3-beta-2-to-developers/" target="_blank" rel="external">链接</a>。<br>   <img src="http://7te818.com1.z0.glb.clouddn.com/14568532311607.jpg?imageView/2/w/600/q/60" alt=""></p>
<p>  &emsp;&emsp;iOS9版本更新过程中对于UL最大的变化在于，从一开始支持不跨域也实现跳转，到后面的跨域才是去跳转页面，这着实坑了不少开发者。</p>
<p> &emsp;&emsp;按照以往的iOS设备升级经验iOS9的升级用户在过去一年中应该已经到达80%了，这么多的高流量App都可以支持UL，那个被微信屏蔽的App闭环是否可以被打破呢？嘿嘿，大家想想就可以知道了。</p>
<p> <a href="https://www.macstories.net/ios/twitter-for-ios-adds-universal-links-support-on-ios-9/" target="_blank" rel="external">Twitter对于UL使用案例</a>。</p>
<p> 目前国内对UL支持力度较大的有天猫、知乎、网易新闻。</p>
<p>###3.UL到底是个什么玩意？<br>简单来说，UL是iOS系统通过技术手段，将<a href="http://www.haha.com" target="_blank" rel="external">http://www.haha.com</a> 链接识别成App可识别链接，这样只要有App到这个URL，那个系统就会默认去唤起对应App。<br>UL主流程如下：<br><img src="http://7te818.com1.z0.glb.clouddn.com/picture915-2.png?imageView/2/w/400/q/45" alt=""></p>
<p>这些步骤涉及客户端、服务端以及前端，技术实现难度不大，协同配合校验是比较麻烦的。</p>
<p>###4. 适配UL</p>
<ul>
<li><p>踩坑hahaha<br><img src="http://7te818.com1.z0.glb.clouddn.com/14569005737114.jpg?imageView/2/w/600/q/60" alt=""></p>
</li>
<li><p>客户端</p>
<ul>
<li>Xcode 工程配置上AppLinks://URL,详情请参考官方文档</li>
<li>APPDelegate中的continueUserActivity中回调一个userActivity，自带一个URL，这个就是UL带过来的URL</li>
<li>实现细节和Web Markup一模一样。</li>
</ul>
</li>
<li><p>前端以及服务端</p>
<ul>
<li>相关网页根域名下配置apple-app-site-association文件，该文件不需要注明格式</li>
<li>必须走https</li>
<li><p>必须不包含重定向</p>
<p><img src="http://7te818.com1.z0.glb.clouddn.com/14569089086483.jpg?imageView/2/w/600/q/60" alt=""></p>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>测试验证</p>
<ul>
<li>网络请求抓包，apple-app-site-association文件更新逻辑只在<strong>客户端安装以及更新</strong>时触发，如下图所示。</li>
<li><p>Mail、Message、备忘录这些系统App可以长按连接通过选择ActionSheet来辨别UL是否支持</p>
<p><img src="http://7te818.com1.z0.glb.clouddn.com/14568124648916.jpg" alt=""></p>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>缺陷</p>
<ul>
<li>iOS 9及以上才支持。</li>
<li>App未安装不会触发任何UL跳转。</li>
<li>多个App为了避免互相UL跳转时，如果是公用的URL最好不要支持UL，即使apple-app-site-association里面包含了两个AppID，也是有先后顺序的，感觉这个是个功能BUG，需要向Apple提出来。</li>
</ul>
</li>
<li><p>猜想</p>
<ul>
<li>如何统计UL来源？Apple并没有开放对应API，但是iOS9以上StatusBar左侧包含了App的来源，我们可以通过截图上传服务器的形式来统计对应UL来源。</li>
<li>UL文件在设备的存放位置，不知道是App沙盒内部，还在其他目录，可以通过越狱渠道，查看设备文件结构。</li>
<li>UL内部的实现细节还是没有太多暴露给开发，新技术的坑还真是比较多。</li>
</ul>
</li>
</ul>
<p>###5. 结尾</p>
<p>   &emsp;&emsp;纵观iOS9 带来的新技术，从表面的3D-touch ，到新的WebView，再到iPad的支持分配，这些都是浮在表面的；UL的确是个比较隐蔽的技术手段，目前我们团队也在对应的有所实现，嘿嘿，接下来就是看数据结果，令人期待。App之间闭环、引流真是有说不完的故事，也是技术之间的不断博弈。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/01/30/从Web-Mark-up-到-Universal-Link/" data-id="cinoe4rtg0008e5isl1yjslwo" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/05/01/hello-world/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Hello World
        
      </div>
    </a>
  
  
    <a href="/2015/12/04/iOS9-Search-link-anythings/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">iOS9 Search link anythings</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">July 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">March 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/">January 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">December 2014</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/05/01/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2016/01/30/从Web-Mark-up-到-Universal-Link/">从Web Mark up 到 Universal Link</a>
          </li>
        
          <li>
            <a href="/2015/12/04/iOS9-Search-link-anythings/">iOS9 Search link anythings</a>
          </li>
        
          <li>
            <a href="/2015/08/09/AsyncDisplayKit随想/">AsyncDisplayKit随想</a>
          </li>
        
          <li>
            <a href="/2015/07/24/LinkMap分析初窥/">LinkMap分析初窥</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>